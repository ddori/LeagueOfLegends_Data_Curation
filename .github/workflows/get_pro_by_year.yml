name: Get Pro Data

on:
  workflow_dispatch:
    inputs:
      year:
        description: "Year to artifact (default 2025)"
        required: true
        default: "2025"

jobs:
  pro:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install rclone
        run: curl -fsSL https://rclone.org/install.sh | sudo bash

      - name: Write Service Account JSON (from base64)
        run: |
          mkdir -p $HOME/.config/rclone
          echo "${{ secrets.GDRIVE_SA_JSON_B64 }}" | base64 -d > $HOME/.config/rclone/sa.json

      - name: Create rclone config
        run: |
          cat > $HOME/.config/rclone/rclone.conf <<'EOF'
          [gdrv]
          type = drive
          scope = drive
          service_account_file = /home/runner/.config/rclone/sa.json
          root_folder_id = 1gLSw0RLjBbtaNy0dgnGQDAZOHIgCe-HH
          EOF

      - name: Download ALL files from Drive folder
        run: |
          mkdir -p data/pro_raw
          rclone copy gdrv: data/pro_raw -P
          ls -al data/pro_raw

      - name: Upload artifact (only selected year)
        uses: actions/upload-artifact@v4
        with:
          name: pro_${{ github.event.inputs.year }}
          path: data/pro_raw/${{ github.event.inputs.year }}_LoL_esports_match_data_from_OraclesElixir.csv
          if-no-files-found: error
          retention-days: 14
